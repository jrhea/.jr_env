#!/usr/bin/env bash
set -euo pipefail

JR_ENV="$HOME/.jr_env"
SYS="$JR_ENV/config/sys"

link() {
  local src="$1"
  local dst="$2"

  mkdir -p "$(dirname "$dst")"

  # If dst exists and is NOT a symlink, back it up
  if [ -e "$dst" ] && [ ! -L "$dst" ]; then
    mv "$dst" "$dst.bak.$(date +%Y%m%d%H%M%S)"
  fi

  ln -sfn "$src" "$dst"
}

# --- Shell dotfiles ---
link "$SYS/.bashrc"        "$HOME/.bashrc"
link "$SYS/.bash_profile"  "$HOME/.bash_profile"
link "$SYS/.bash_aliases"  "$HOME/.bash_aliases"
link "$SYS/.bash_logout"   "$HOME/.bash_logout"
link "$SYS/.gitconfig"     "$HOME/.gitconfig"
link "$SYS/.vimrc"         "$HOME/.vimrc"

# --- Neovim ---
link "$JR_ENV/config/nvim" "$HOME/.config/nvim"

chsh -s /bin/bash

# Load bash profile for current session (best-effort)
if [ -f "$HOME/.bash_profile" ]; then
  # shellcheck disable=SC1090
  source "$HOME/.bash_profile" || true
fi
